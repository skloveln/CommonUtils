<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.zpc.mvc.sys.dao.ApiLogDao" >

    <resultMap id="ApiLog" type="cn.zpc.mvc.sys.entity.ApiLog">
        <id property="id" column="id"></id>
        <result property="url" column="request_url"></result>
        <result property="param" column="param"></result>
        <result property="userId" column="user_id"></result>
        <result property="version" column="version"></result>
        <result property="os" column="os"></result>
        <result property="time" column="request_time"></result>
    </resultMap>

    <insert id="insert">
        INSERT INTO
          log_request_api
        (
          request_url,
          <if test="param != null and param !=''">
            param,
          </if>
          <if test="userId != null">
            user_id,
          </if>
          version,
          os,
          request_time
        )VALUES (
          #{url},
        <if test="param != null and param !=''">
          #{param},
        </if>
        <if test="userId != null">
          #{userId},
        </if>
          #{version},
          #{os},
          #{time}
        )
    </insert>

    <select id="getByRequestUrl" resultMap="ApiLog">
        SELECT
          *
        FROM
          log_request_api
        WHERE
          request_url = #{url}
        AND
          DATEDIFF(NOW(), request_time) &lt; 30
    </select>

</mapper>