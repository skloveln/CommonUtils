<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.zpc.mvc.user.dao.UserWeChatDao" >
    <resultMap id="UserWechat" type="cn.zpc.mvc.user.entity.UserWechat">
        <id property="id" column="id"></id>
        <result column="user_id" property="userId"></result>
        <result column="phone" property="phone"></result>
        <result column="open_id" property="openId"></result>
        <result column="nickname" property="nickName"></result>
        <result column="sex" property="sex"></result>
        <result column="province" property="province"></result>
        <result column="head_img" property="headImg"></result>
        <result column="city" property="city"></result>
        <result column="union_id" property="unionId"></result>
        <result column="privilege" property="privilege"></result>
        <result column="country" property="country"></result>
        <result column="refresh_token" property="refreshToken"></result>
        <result column="create_time" property="createTime"></result>
    </resultMap>

    <select id="findByOpenId" resultMap="UserWechat">
      SELECT
        *
      FROM
        lb_user_wechat
      WHERE
        open_id = #{openId}
      AND
        deleted = 0
    </select>

    <update id="deleteWechat">
        UPDATE
        lb_user_wechat
        SET
        deleted = 1
        WHERE
        user_id = #{userId}
    </update>

    <select id="findByUserId" resultMap="UserWechat">
        SELECT
        *
        FROM
        lb_user_wechat
        WHERE
        user_id = #{userId}
        AND
        deleted = 0
    </select>

    <select id="findByUserPhone" resultMap="UserWechat">
        SELECT
        *
        FROM
        lb_user_wechat
        WHERE
        phone = #{phone}
        AND
        deleted = 0
    </select>

    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
       INSERT
       lb_user_wechat(
       <if test="userId != null">
           user_id,
       </if>
        <if test="phone != null">
            phone,
        </if>
        open_id,
        nickname,
        sex,
        province,
        head_img,
        city,
        country,
        privilege,
        union_id,
        refresh_token
       )
       VALUES (
        <if test="userId != null">
            #{userId},
        </if>
        <if test="phone != null">
            #{phone},
        </if>
        #{openId},
        #{nickName},
        #{sex},
        #{province},
        #{headImg},
        #{city},
        #{country},
        #{privilege},
        #{unionId},
        #{refreshToken}
       )
    </insert>

    <update id="update">
        UPDATE
        lb_user_wechat
        SET
        user_id = #{userId},
        phone = #{phone}
        WHERE
        open_id = #{openId}
    </update>
</mapper>